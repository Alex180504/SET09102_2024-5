<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:SET09102_2024_5.ViewModels"
             xmlns:models="clr-namespace:SET09102_2024_5.Models"
             xmlns:converters="clr-namespace:SET09102_2024_5.Converters"
             xmlns:helpers="clr-namespace:SET09102_2024_5.Helpers"
             xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
             x:DataType="vm:RoleManagementViewModel"
             x:Class="SET09102_2024_5.Views.RoleManagementPage"
             Title="Role Management"
             BackgroundColor="{AppThemeBinding Light=#f5f5f5, Dark=#1f1f1f}">

    <ContentPage.Resources>
        <converters:StringNotNullOrEmptyConverter x:Key="StringNotNullOrEmptyConverter"/>
        <converters:InvertedBoolConverter x:Key="InvertedBoolConverter"/>

        <Style x:Key="CardStyle"
               TargetType="Frame">
            <Setter Property="BorderColor"
                    Value="{AppThemeBinding Light=#e0e0e0, Dark=#3e3e3e}"/>
            <Setter Property="BackgroundColor"
                    Value="{AppThemeBinding Light=White, Dark=#2e2e2e}"/>
            <Setter Property="CornerRadius"
                    Value="12"/>
            <Setter Property="HasShadow"
                    Value="True"/>
            <Setter Property="Padding"
                    Value="0"/>
            <Setter Property="Margin"
                    Value="0,8"/>
            <Setter Property="Shadow">
                <Shadow Brush="#66000000"
                        Offset="0,3"
                        Radius="6"/>
            </Setter>
        </Style>

        <Style x:Key="CardHeaderStyle"
               TargetType="Grid">
            <Setter Property="Padding"
                    Value="16"/>
            <Setter Property="BackgroundColor"
                    Value="{AppThemeBinding Light=#3f51b5, Dark=#303f9f}"/>
        </Style>

        <Style x:Key="SectionTitleStyle"
               TargetType="Label">
            <Setter Property="FontSize"
                    Value="18"/>
            <Setter Property="FontAttributes"
                    Value="Bold"/>
            <Setter Property="TextColor"
                    Value="White"/>
            <Setter Property="VerticalOptions"
                    Value="Center"/>
        </Style>

        <Style x:Key="HeaderIconStyle"
               TargetType="Label">
            <Setter Property="FontSize"
                    Value="24"/>
            <Setter Property="TextColor"
                    Value="White"/>
            <Setter Property="FontFamily"
                    Value="MaterialIcons"/>
            <Setter Property="VerticalOptions"
                    Value="Center"/>
        </Style>

        <Style x:Key="FormLabelStyle"
               TargetType="Label">
            <Setter Property="FontSize"
                    Value="14"/>
            <Setter Property="TextColor"
                    Value="{AppThemeBinding Light=#505050, Dark=#b0b0b0}"/>
            <Setter Property="Margin"
                    Value="5,0,0,3"/>
        </Style>

        <Style x:Key="ActionButtonStyle"
               TargetType="Button">
            <Setter Property="CornerRadius"
                    Value="8"/>
            <Setter Property="Padding"
                    Value="16,8"/>
            <Setter Property="TextColor"
                    Value="White"/>
            <Setter Property="FontAttributes"
                    Value="Bold"/>
        </Style>
    </ContentPage.Resources>

    <Grid Padding="16"
          RowSpacing="16"
          ColumnSpacing="16">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <!-- Page Header -->
        <Border Grid.Row="0"
                Grid.ColumnSpan="2"
                BackgroundColor="{AppThemeBinding Light=#3f51b5, Dark=#303f9f}"
                StrokeThickness="0"
                StrokeShape="RoundRectangle 12,12,12,12"
                Padding="20"
                Margin="0,0,0,8">
            <Grid ColumnDefinitions="Auto,*,Auto">
                <Label Grid.Column="0"
                       Text="{x:Static helpers:MaterialIcons.Group}"
                       FontFamily="MaterialIcons"
                       TextColor="White"
                       FontSize="32"
                       VerticalOptions="Center"/>

                <VerticalStackLayout Grid.Column="1"
                                     Margin="16,0,0,0">
                    <Label Text="Role Management"
                           FontSize="24"
                           FontAttributes="Bold"
                           TextColor="White"/>
                    <Label Text="Create and manage roles with specific access privileges"
                           FontSize="14"
                           TextColor="#e0e0e0"/>
                </VerticalStackLayout>

                <Button Grid.Column="2"
                        Text="{x:Static helpers:MaterialIcons.Refresh}"
                        FontFamily="MaterialIcons"
                        Command="{Binding RefreshCommand}"
                        BackgroundColor="Transparent"
                        TextColor="White"
                        FontSize="24"
                        Padding="8"
                        VerticalOptions="Center"
                        HorizontalOptions="End"/>
            </Grid>
        </Border>

        <!-- Left Side: Roles List and Create New Role -->
        <Grid Grid.Row="1"
              Grid.Column="0"
              RowDefinitions="Auto,*">
            <!-- Create New Role Section -->
            <Frame Grid.Row="0"
                   Style="{StaticResource CardStyle}">
                <Grid RowDefinitions="Auto,*">
                    <!-- Card Header -->
                    <Grid Style="{StaticResource CardHeaderStyle}"
                          BackgroundColor="{AppThemeBinding Light=#2196F3, Dark=#1976D2}">
                        <HorizontalStackLayout Spacing="12">
                            <Label Text="{x:Static helpers:MaterialIcons.Add_Circle}"
                                   Style="{StaticResource HeaderIconStyle}"/>
                            <Label Text="Create New Role"
                                   Style="{StaticResource SectionTitleStyle}"/>
                        </HorizontalStackLayout>
                    </Grid>

                    <!-- Card Content -->
                    <VerticalStackLayout Grid.Row="1"
                                         Padding="16"
                                         Spacing="12">
                        <Label Text="Role Name"
                               Style="{StaticResource FormLabelStyle}"/>

                        <Entry Placeholder="Enter role name"
                               Text="{Binding NewRoleName}"
                               BackgroundColor="Transparent"
                               Margin="8,0"/>

                        <Label Text="Description"
                               Style="{StaticResource FormLabelStyle}"
                               Margin="5,10,0,3"/>

                        <Entry Placeholder="Enter role description"
                               Text="{Binding NewRoleDescription}"
                               BackgroundColor="Transparent"
                               Margin="8,0"/>

                        <Button Text="Create Role"
                                Command="{Binding CreateRoleCommand}"
                                Style="{StaticResource ActionButtonStyle}"
                                BackgroundColor="#2196F3"
                                Margin="0,10,0,0"
                                HorizontalOptions="Start"/>
                    </VerticalStackLayout>
                </Grid>
            </Frame>

            <!-- Roles List -->
            <Frame Grid.Row="1"
                   Style="{StaticResource CardStyle}"
                   Margin="0,16,0,0">
                <Grid RowDefinitions="Auto,*">
                    <!-- Card Header -->
                    <Grid Style="{StaticResource CardHeaderStyle}"
                          BackgroundColor="{AppThemeBinding Light=#673AB7, Dark=#512DA8}">
                        <HorizontalStackLayout Spacing="12">
                            <Label Text="{x:Static helpers:MaterialIcons.Group}"
                                   Style="{StaticResource HeaderIconStyle}"/>
                            <Label Text="Available Roles"
                                   Style="{StaticResource SectionTitleStyle}"/>
                        </HorizontalStackLayout>
                    </Grid>

                    <!-- Card Content -->
                    <Grid Grid.Row="1"
                          RowDefinitions="Auto,*"
                          Padding="16">
                        <Label Grid.Row="0"
                               Text="Select a role to edit"
                               HorizontalOptions="Start"
                               FontSize="14"
                               Margin="0,0,0,8"
                               TextColor="{AppThemeBinding Light=#707070, Dark=#a0a0a0}"/>

                        <CollectionView Grid.Row="1"
                                        ItemsSource="{Binding Roles}"
                                        SelectedItem="{Binding SelectedRole}"
                                        SelectionMode="Single"
                                        VerticalOptions="Fill">
                            <CollectionView.ItemTemplate>
                                <DataTemplate x:DataType="models:Role">
                                    <Border Margin="0,5"
                                            Stroke="{AppThemeBinding Light=#e0e0e0, Dark=#505050}"
                                            StrokeThickness="1"
                                            StrokeShape="RoundRectangle 8"
                                            Padding="12">
                                        <Grid ColumnDefinitions="*,Auto">
                                            <VerticalStackLayout Grid.Column="0"
                                                                 Spacing="4">
                                                <Label Text="{Binding RoleName}"
                                                       FontAttributes="Bold"
                                                       FontSize="16"
                                                       TextColor="{AppThemeBinding Light=#202020, Dark=#e0e0e0}"/>

                                                <Label Text="{Binding Description}"
                                                       LineBreakMode="TailTruncation"
                                                       FontSize="14"
                                                       TextColor="{AppThemeBinding Light=#606060, Dark=#a0a0a0}"/>
                                            </VerticalStackLayout>

                                            <Label Grid.Column="1"
                                                   Text="{x:Static helpers:MaterialIcons.Arrow_Forward}"
                                                   FontFamily="MaterialIcons"
                                                   TextColor="{AppThemeBinding Light=#9E9E9E, Dark=#707070}"
                                                   FontSize="20"
                                                   VerticalOptions="Center"/>
                                        </Grid>
                                    </Border>
                                </DataTemplate>
                            </CollectionView.ItemTemplate>
                            <CollectionView.EmptyView>
                                <VerticalStackLayout HorizontalOptions="Center"
                                                     VerticalOptions="Center"
                                                     Spacing="12">
                                    <Label Text="{x:Static helpers:MaterialIcons.Search}"
                                           FontFamily="MaterialIcons"
                                           TextColor="{AppThemeBinding Light=#9E9E9E, Dark=#707070}"
                                           FontSize="48"
                                           HorizontalOptions="Center"/>
                                    <Label Text="No Roles Found"
                                           FontSize="16"
                                           TextColor="{AppThemeBinding Light=#757575, Dark=#909090}"
                                           HorizontalOptions="Center"/>
                                    <Label Text="Create a new role to get started"
                                           FontSize="14"
                                           TextColor="{AppThemeBinding Light=#9E9E9E, Dark=#707070}"
                                           HorizontalOptions="Center"/>
                                </VerticalStackLayout>
                            </CollectionView.EmptyView>
                        </CollectionView>
                    </Grid>
                </Grid>
            </Frame>
        </Grid>

        <!-- Right Side: Role Details and Privileges -->
        <Grid Grid.Row="1"
              Grid.Column="1"
              RowDefinitions="Auto,*">
            <!-- No Role Selected Message -->
            <ContentView Grid.RowSpan="2"
                         IsVisible="{Binding SelectedRole, Converter={StaticResource StringNotNullOrEmptyConverter}, ConverterParameter=True}">
                <VerticalStackLayout HorizontalOptions="Center"
                                     VerticalOptions="Center"
                                     Spacing="20">
                    <Label Text="{x:Static helpers:MaterialIcons.Info}"
                           FontFamily="MaterialIcons"
                           TextColor="{AppThemeBinding Light=#9E9E9E, Dark=#707070}"
                           FontSize="64"
                           HorizontalOptions="Center"/>
                    <Label Text="No Role Selected"
                           FontSize="20"
                           TextColor="{AppThemeBinding Light=#757575, Dark=#909090}"
                           HorizontalOptions="Center"/>
                    <Label Text="Select a role from the list to view and edit its details"
                           FontSize="16"
                           TextColor="{AppThemeBinding Light=#9E9E9E, Dark=#707070}"
                           HorizontalOptions="Center"
                           HorizontalTextAlignment="Center"/>
                </VerticalStackLayout>
            </ContentView>

            <!-- Role Details -->
            <Frame Grid.Row="0"
                   Style="{StaticResource CardStyle}"
                   IsVisible="{Binding SelectedRole, Converter={StaticResource StringNotNullOrEmptyConverter}}">
                <Grid RowDefinitions="Auto,*">
                    <!-- Card Header -->
                    <Grid Style="{StaticResource CardHeaderStyle}"
                          BackgroundColor="{AppThemeBinding Light=#FF9800, Dark=#F57C00}">
                        <HorizontalStackLayout Spacing="12">
                            <Label Text="{x:Static helpers:MaterialIcons.Edit}"
                                   Style="{StaticResource HeaderIconStyle}"/>
                            <Label Text="Edit Role Details"
                                   Style="{StaticResource SectionTitleStyle}"/>
                        </HorizontalStackLayout>
                    </Grid>

                    <!-- Card Content -->
                    <VerticalStackLayout Grid.Row="1"
                                         Padding="16"
                                         Spacing="12">
                        <Label Text="Role Name"
                               Style="{StaticResource FormLabelStyle}"/>

                        <Border Stroke="{AppThemeBinding Light=#e0e0e0, Dark=#505050}"
                                StrokeThickness="1"
                                StrokeShape="RoundRectangle 6"
                                Padding="5,0">
                            <Entry Placeholder="Role name"
                                   Text="{Binding SelectedRole.RoleName}"
                                   BackgroundColor="Transparent"
                                   Margin="8,0"/>
                        </Border>

                        <Label Text="Description"
                               Style="{StaticResource FormLabelStyle}"/>

                        <Border Stroke="{AppThemeBinding Light=#e0e0e0, Dark=#505050}"
                                StrokeThickness="1"
                                StrokeShape="RoundRectangle 6"
                                Padding="5,0">
                            <Entry Placeholder="Role description"
                                   Text="{Binding SelectedRole.Description}"
                                   BackgroundColor="Transparent"
                                   Margin="8,0"/>
                        </Border>

                        <HorizontalStackLayout Spacing="12"
                                               Margin="0,10,0,0">
                            <Button Text="Save Changes"
                                    Command="{Binding SaveRoleCommand}"
                                    Style="{StaticResource ActionButtonStyle}"
                                    BackgroundColor="#4CAF50">
                                <Button.Shadow>
                                    <Shadow Brush="#404CAF50"
                                            Offset="0,2"
                                            Radius="4"/>
                                </Button.Shadow>
                            </Button>

                            <Button Text="Delete Role"
                                    Command="{Binding DeleteRoleCommand}"
                                    Style="{StaticResource ActionButtonStyle}"
                                    BackgroundColor="#F44336">
                                <Button.Shadow>
                                    <Shadow Brush="#40F44336"
                                            Offset="0,2"
                                            Radius="4"/>
                                </Button.Shadow>
                            </Button>
                        </HorizontalStackLayout>
                    </VerticalStackLayout>
                </Grid>
            </Frame>

            <!-- Access Privileges -->
            <Frame Grid.Row="1"
                   Style="{StaticResource CardStyle}"
                   Margin="0,16,0,0"
                   IsVisible="{Binding SelectedRole, Converter={StaticResource StringNotNullOrEmptyConverter}}">
                <Grid RowDefinitions="Auto,*">
                    <!-- Card Header -->
                    <Grid Style="{StaticResource CardHeaderStyle}"
                          BackgroundColor="{AppThemeBinding Light=#9C27B0, Dark=#7B1FA2}">
                        <HorizontalStackLayout Spacing="12">
                            <Label Text="{x:Static helpers:MaterialIcons.Lock}"
                                   Style="{StaticResource HeaderIconStyle}"/>
                            <Label Text="Access Privileges"
                                   Style="{StaticResource SectionTitleStyle}"/>
                        </HorizontalStackLayout>
                    </Grid>

                    <!-- Card Content -->
                    <Grid Grid.Row="1"
                          Padding="16">
                        <ScrollView>
                            <CollectionView ItemsSource="{Binding RolePrivileges}"
                                            SelectionMode="None">
                                <CollectionView.ItemTemplate>
                                    <DataTemplate x:DataType="vm:AccessPrivilegeViewModel">
                                        <Border Margin="0,4"
                                                Stroke="{AppThemeBinding Light=#e0e0e0, Dark=#505050}"
                                                StrokeThickness="1"
                                                StrokeShape="RoundRectangle 8"
                                                Padding="12">
                                            <Grid ColumnDefinitions="Auto,*">
                                                <CheckBox Grid.Column="0"
                                                          IsChecked="{Binding IsAssigned}"
                                                          VerticalOptions="Center"
                                                          HorizontalOptions="Center"/>

                                                <VerticalStackLayout Grid.Column="1"
                                                                     VerticalOptions="Center"
                                                                     Spacing="4"
                                                                     Margin="8,0,0,0">
                                                    <Label Text="{Binding AccessPrivilege.Name}"
                                                           FontAttributes="Bold"
                                                           FontSize="14"
                                                           TextColor="{AppThemeBinding Light=#202020, Dark=#e0e0e0}"/>

                                                    <Label Text="{Binding AccessPrivilege.Description}"
                                                           FontSize="12"
                                                           TextColor="{AppThemeBinding Light=#606060, Dark=#a0a0a0}"/>

                                                    <Border BackgroundColor="{AppThemeBinding Light=#e3f2fd, Dark=#263238}"
                                                            Padding="6,3"
                                                            StrokeShape="RoundRectangle 4"
                                                            HorizontalOptions="Start"
                                                            Margin="0,3,0,0">
                                                        <Label Text="{Binding AccessPrivilege.ModuleName}"
                                                               FontSize="11"
                                                               TextColor="{AppThemeBinding Light=#1976d2, Dark=#90caf9}"/>
                                                    </Border>
                                                </VerticalStackLayout>
                                            </Grid>
                                        </Border>
                                    </DataTemplate>
                                </CollectionView.ItemTemplate>
                                <CollectionView.EmptyView>
                                    <VerticalStackLayout HorizontalOptions="Center"
                                                         VerticalOptions="Center"
                                                         Spacing="12">
                                        <Label Text="{x:Static helpers:MaterialIcons.NotAvailable}"
                                               FontFamily="MaterialIcons"
                                               TextColor="{AppThemeBinding Light=#9E9E9E, Dark=#707070}"
                                               FontSize="48"
                                               HorizontalOptions="Center"/>
                                        <Label Text="No Privileges Available"
                                               FontSize="16"
                                               TextColor="{AppThemeBinding Light=#757575, Dark=#909090}"
                                               HorizontalOptions="Center"/>
                                    </VerticalStackLayout>
                                </CollectionView.EmptyView>
                            </CollectionView>
                        </ScrollView>
                    </Grid>
                </Grid>
            </Frame>
        </Grid>

        <!-- Loading Indicator -->
        <Grid Grid.ColumnSpan="2"
              Grid.RowSpan="2"
              IsVisible="{Binding IsBusy}"
              BackgroundColor="{AppThemeBinding Light=#80FFFFFF, Dark=#80000000}">
            <VerticalStackLayout HorizontalOptions="Center"
                                 VerticalOptions="Center"
                                 Spacing="12">
                <ActivityIndicator IsRunning="{Binding IsBusy}"
                                   Color="{AppThemeBinding Light=#3f51b5, Dark=#7986CB}"
                                   WidthRequest="40"
                                   HeightRequest="40"/>
                <Label Text="{Binding Title}"
                       TextColor="{AppThemeBinding Light=#3f51b5, Dark=#7986CB}"
                       HorizontalOptions="Center"/>
            </VerticalStackLayout>
        </Grid>
    </Grid>
</ContentPage>